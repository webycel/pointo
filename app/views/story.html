<div ng-cloak class="story">

    <div class="session-loading" ng-hide="view > 0">
        <h2>{{ 'Loading session ' + sessionID }}</h2>
        <div class="loading-bar"></div>
    </div>

    <div ng-show="view === 1">

        <div class="row">
            
            <div class="col-md-3 col-sm-4 col-xs-12 voting">
                <h2>Vote</h2>
                <ul>
                    <li class="btn point" ng-repeat="point in storypoints | filter:'!X'" ng-click="vote(point)" ng-class="{active: session.users[user.key].points.value === point.value, 'glyphicon glyphicon-question-sign': point.value === -2}">
                        {{point.value !== -2 ? point.text : ''}}
                    </li>
                </ul>
                
                <h3>Actions</h3>
                <button class="btn-action options" ng-class="{disabled: session.voteStatus == 1}" ng-click="revealVotes()">Reveal all votes</button>
                <button class="btn-light options" ng-class="{disabled: session.voteStatus == 0}" ng-click="clearVotes()">Clear all votes</button>
            </div>

            <div class="col-md-9 col-sm-8 col-xs-12">
                <h2>Participants</h2>

                <div class="row participants">
                    <div class="col-md-2 col-sm-2 col-xs-3 participant" ng-repeat="(id, p) in participants" ng-class="{active: id == user.key}">
                        <span class="name">{{p.name}}</span>
                        <span class="rated glyphicon" ng-class="{'glyphicon-time': p.points.value === -1 && session.voteStatus === 0, 'glyphicon-ok': p.points.value !== -1 && session.voteStatus === 0, 'glyphicon-remove': p.points.value === -1 && session.voteStatus === 1, 'glyphicon-question-sign': p.points.value === -2 && session.voteStatus === 1, 'flipped': isFlipped}">
                            {{ session.voteStatus === 1 ? (p.points.value > -1 ? p.points.text : '') : '' }}
                        </span>
                    </div>
                </div>

                <div class="row stats" ng-class="{hidden: session.voteStatus == 0 || statistics().participants <= 1}">
                    <div class="col-md-10 col-sm-11 col-xs-12">
                        <canvas class="chart chart-bar" data="stats.data" labels="stats.labels" options="stats.options"></canvas>
                    </div>
                </div>
            </div>

        </div>

        <div class="row settings">
            <div class="col-md-3 col-sm-4 col-xs-12">
                <form ng-submit="changeName()">
                    <h3>Settings</h3>
                    <div class="form-group">
                        <input type="text" class="name" placeholder="Your name" ng-model="newName" required />
                        <input type="submit" value="Change name" ng-class="{disabled: newName === user.name}" />
                    </div>
                </form>
            </div>
        </div>

    </div>





    <div class="row" ng-show="view === 2">

        <div class="set_name">
            <h1>Session {{sessionID}}</h1>

            <form ng-submit="joinSession()">

                <div class="form-group">
                    <input type="text" class="name" placeholder="Your name" ng-model="name" required />
                    <input type="submit" value="Join Session" />
                </div>

            </form>
        </div>

    </div>    

</div>